var app=angular.module("sportApp",["ui.router","svgSprites","ngFileUpload"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("login",{url:"/",templateUrl:"views/login.html",controller:"LoginController"}).state("home",{url:"/home",templateUrl:"views/home.html",controller:"HomeController"}).state("new_reservation",{url:"/new_reservation",templateUrl:"views/new_reservation.html",controller:"NewReservationController"}).state("reservations",{url:"/reservations",templateUrl:"views/reservations.html",controller:"ReservationsController"}).state("edit_reservation",{url:"/edit_reservation",templateUrl:"views/edit_reservation.html",controller:"EditReservationController"}).state("view_assets.new_asset",{url:"/new_asset",templateUrl:"views/new_asset.html",controller:"NewAssetController"}).state("view_assets",{url:"/view_assets",templateUrl:"views/view_assets.html",controller:"ViewAssetsController"}).state("view_assets.edit_asset",{url:"/edit_asset",templateUrl:"views/edit_asset.html",controller:"EditAssetController"}).state("available_assets",{url:"/available_assets",templateUrl:"views/available_assets.html",controller:"AvailableAssetsController"}).state("reserve_asset",{url:"/reserve_asset",templateUrl:"views/reserve_asset.html",controller:"ReserveFromAssetsController"}).state("view_assets.asset_reservations",{url:"/asset_reservations",templateUrl:"views/asset_reservations.html",controller:"AssetReservationController"}),c.html5Mode(!0)}]),app.controller("LoginController",["$scope","$http","$location","$window",function(a,b,c,d){a.login=function(){d.location="/login"},b.get("/loggedIn").then(function(a){a.data&&c.path("/home")})}]),app.controller("HomeController",["$scope","ReservationService",function(a,b){a.loading=!0,b.getEvents(),b.getAssets(),a.data=b.data,a.afterToday=function(a){var b=new Date(a.eventStartTime),c=new Date;return b>c}}]),app.controller("AssetsController",function(){}),app.controller("ReserveFromAssetsController",["$scope","$http","$location","ReservationService","currentAsset",function(a,b,c,d,e){d.getEvents(),a.data=d.data,a.firstAsset=e.currentAsset,a.firstAsset.selected=!0,a.assets=[],a.selectedEvent="",a.selectedAssets=[a.firstAsset.id],a.reservedBy="",a.events=d.data.eventsAfterToday;var f=[],g=function(){b({url:"/internal/getEventsByAsset",method:"GET",params:{asset_id:a.firstAsset.id}}).then(function(b){function c(b){for(i=0;i<a.events.length;i++){var c,d=a.events[i].start_date_time,e=a.events[i].end_date_time,f=b.start_date_time,g=b.end_date_time;c=d>f&&g>d?"fail":e>f&&g>e?"fail":f>d&&e>f?"fail":g>d&&e>g?"fail":"pass","fail"==c&&a.events.splice(i,1)}}for(i=0;i<a.events.length;i++)for(j=0;j<b.data.length;j++)parseInt(a.events[i].id)==b.data[j].event_id&&(f.push(a.events[i]),a.events.splice(i,1));for(i=0;i<f.length;i++)c(f[i])})};a.getAvailable=function(){var c=["'"+a.selectedEvent.id+"'"];for(i=0;i<a.events.length;i++){var d,e=a.events[i].start_date_time,f=a.events[i].end_date_time,g=a.selectedEvent.start_date_time,h=a.selectedEvent.end_date_time;d=e>g&&h>e?"fail":f>g&&h>f?"fail":g>e&&f>g?"fail":h>e&&f>h?"fail":"pass","fail"==d&&c.push("'"+a.events[i].id+"'")}a.assets=[],b({url:"/internal/getAvailable",method:"GET",params:{event_list:'"'+c+'"'}}).then(function(b){for(i=0;b.data.length;i++)b.data[i].id!==a.firstAsset.id&&a.assets.push(b.data[i])})},a.createReservation=function(){for(var d=0;d<a.assets.length;d++)a.assets[d].selected===!0&&a.selectedAssets.push(parseInt(a.assets[d].id));b.post("internal/reservation",{eventId:a.selectedEvent.id,selectedAssets:a.selectedAssets,reservedBy:a.reservedBy}).then(function(a){200===a.status?c.path("/reservations"):console.log("error")})},a.cancel=function(){c.path("view_assets")},g()}]),app.controller("NewReservationController",["$scope","$http","$location","ReservationService",function(a,b,c,d){d.getEvents(),d.getAssets(),a.data=d.data,a.assets=[],a.events=d.data.eventsAfterToday,a.selectedEvent="",a.selectedAssets=[],a.reservedBy="",a.getAvailable=function(){var c=["'"+a.selectedEvent.id+"'"];for(i=0;i<a.events.length;i++){var d,e=a.events[i].start_date_time,f=a.events[i].end_date_time,g=a.selectedEvent.start_date_time,h=a.selectedEvent.end_date_time;d=e>g&&h>e?"fail":f>g&&h>f?"fail":g>e&&f>g?"fail":h>e&&f>h?"fail":"pass","fail"==d&&c.push("'"+a.events[i].id+"'")}a.assets=[],b({url:"/internal/getAvailable",method:"GET",params:{event_list:'"'+c+'"'}}).then(function(b){a.assets=b.data})},a.createReservation=function(){for(var d=0;d<a.assets.length;d++)a.assets[d].selected===!0&&a.selectedAssets.push(parseInt(a.assets[d].id));b.post("internal/reservation",{eventId:a.selectedEvent.id,selectedAssets:a.selectedAssets,reservedBy:a.reservedBy}).then(function(a){200===a.status?c.path("/reservations"):console.log("error")})},a.cancel=function(){c.path("home")}}]),app.controller("ReservationsController",["$scope","$http","$location","ReservationService",function(a,b,c,d){for(a.noRecord=!1,a.all={id:0,title:"All Events"},a.eventsList=[a.all],d.getAssets(),d.getEvents(),a.data=d.data,a.selectedEvent=a.all,a.reservations=[],i=0;i<a.data.eventsAfterToday.length;i++)a.eventsList.push(a.data.eventsAfterToday[i]);a.afterToday=function(a){var b=new Date(a.eventStartTime),c=new Date;return b>c},a.filterReservations=function(){if(a.reservations=[],0===a.selectedEvent.id)a.reservations=d.data.reservations;else for(i=0;i<d.data.reservations.length;i++)d.data.reservations[i].event_id==a.selectedEvent.id&&a.reservations.push(d.data.reservations[i]);a.reservations.length>=1?a.noRecord=!1:a.noRecord=!0},a.editReservation=function(a){d.data.reservationToEdit=a,c.path("edit_reservation")},a.filterReservations()}]),app.controller("EditReservationController",["ReservationService","$http","$scope","$location",function(a,b,c,d){c.data=a.data,c.events=a.data.events,c.assets=[],c.eventsAfterToday=a.data.eventsAfterToday;var e=a.data.reservationToEdit,f=new Date(e.eventStartTime),g=new Date;g>f&&c.eventsAfterToday.unshift({id:parseInt(e.event_id),title:e.eventTitle}),c.reservedBy=e.reserved_by,c.selectedAssets=[];for(var h=0;h<c.data.events.length;h++)if(parseInt(e.event_id)===c.events[h].id){c.selectedEvent=c.events[h];break}c.getAvailable=function(){var a=["'"+c.selectedEvent.id+"'"];for(i=0;i<c.events.length;i++){var d,f=c.events[i].start_date_time,g=c.events[i].end_date_time,h=c.selectedEvent.start_date_time,j=c.selectedEvent.end_date_time;d=f>h&&j>f?"fail":g>h&&j>g?"fail":h>f&&g>h?"fail":j>f&&g>j?"fail":"pass","fail"==d&&a.push("'"+c.events[i].id+"'")}c.assets=[],b({url:"/internal/getAvailable",method:"GET",params:{event_list:'"'+a+'"'}}).then(function(a){c.assets=a.data;for(var b=0;b<e.assets.length;b++)for(var d=0;d<c.assets.length;d++)if(e.assets[b].name===c.assets[d].name){c.assets[d].selected=!0;break}if(e.event_id==c.selectedEvent.id)for(var f=0;f<e.assets.length;f++)e.assets[f].selected=!0,c.assets.push(e.assets[f])})},c.getAvailable(),c.updateReservation=function(){for(var f=0;f<c.assets.length;f++)c.assets[f].selected===!0&&c.selectedAssets.push(c.assets[f].id);b.put("internal/reservation",{id:e.id,eventId:c.selectedEvent.id,selectedAssets:c.selectedAssets,reservedBy:c.reservedBy}).then(function(b){200===b.status?(a.getReservations(),d.path("/reservations")):console.log("error")})},c.deleteReservation=function(){var c=confirm("You are about to permanantly delete this reservation. Click 'OK' to continue.");c===!0&&b["delete"]("/internal/reservation/"+e.id).then(function(b){200===b.status?(a.getReservations(),d.path("/reservations")):console.log("error deleting reservation")})},c.cancel=function(){d.path("reservations"),g>f&&c.eventsAfterToday.shift()}}]),app.controller("NewAssetController",["$scope","$http","$location","Upload","ReservationService",function(a,b,c,d,e){a.data={},a.categoryList=["Practice","Player Equipment","Game","Other"],a.submitAsset=function(){d.upload({url:"/uploads",method:"post",data:a.upload}).then(function(d){b({url:"/internal/newAsset",method:"POST",params:{name:a.data.name,description:a.data.description,category:a.data.category,notes:a.data.notes,imgPath:d.data.path}}).then(function(a){200===a.status&&(e.data.showOverlay=!1,c.path("view_assets"))}),a.closeOverlay=function(){e.data.showOverlay=!1,c.path("view_assets")},console.log(d.data)}),b.get("/uploads").then(function(b){console.log(b.data),a.uploads=b.data})}}]),app.controller("ViewAssetsController",["$scope","$http","$location","currentAsset","ReservationService",function(a,b,c,d,e){a.data=e.data,a.assets=[],a.sortBy="Name",a.sortOptions=["Category","Name","Recently Created"],a.searchKeyword="",a.noRecord=!1,a.startDate,a.endDate;var f=[];e.data.showOverlay=!1,e.getEvents(),e.getAssets(),e.getReservations(),a.getAvailable=function(){function c(a){var b,c=j[i].start_date_time,e=j[i].end_date_time;b=c>d&&g>c?"fail":e>d&&g>e?"fail":d>c&&e>d?"fail":g>c&&e>g?"fail":"pass","fail"==b&&f.push(" '"+j[i].id+"'")}a.assets=[],f=[];var d,g;a.noRecord=!1;var h="%"+a.searchKeyword+"%",j=(e.data.reservations,e.data.events);if(void 0!==a.startDate&&void 0!==a.endDate&&(d=a.startDate.toISOString(),g=a.endDate.toISOString()),void 0!==d)for(i=0;i<j.length;i++)c(j[i]);var k=function(){a.assets=[];var c='"'+f+'"';b({url:"/internal/getAssetsComplex",method:"GET",params:{event_list:c,sortBy:a.sortBy,keyword:h}}).then(function(b){a.assets=b.data,a.assets.length>=1?a.noRecord=!1:a.noRecord=!0})};k()},a.getAvailable(),a.editAsset=function(a){e.data.showOverlay=!0,d.setAsset(a)},a.viewReservations=function(a){e.data.showOverlay=!0,b.get("internal/assetReservations/"+a.id).then(function(b){e.data.assetreservation=b.data;for(var c=0;c<e.data.assetreservation.length;c++)for(var d=e.data.assetreservation[c],f=d.event_id,g=0;g<e.data.events.length;g++){var h=e.data.events[g];if(parseInt(f)===h.id){d.eventTitle=h.title,d.eventStartTime=h.start_date_time,d.eventEndTime=h.end_date_time;break}}e.data.assetreservation.sort(function(a,b){var c=new Date(a.eventStartTime),d=new Date(b.eventStartTime);return c-d}),e.data.assetreservation.name=a.name,e.data.assetreservation.id=a.id})}}]),app.controller("EditAssetController",["$scope","$http","$location","currentAsset","ReservationService","Upload",function(a,b,c,d,e,f){a.data=d.currentAsset,a.categoryList=["Practice","Player Equipment","Game","Other"],a.updateAsset=function(){void 0===a.upload.file?f.upload({url:"/uploads",method:"post",data:a.upload}).then(function(d){b({url:"/internal/updateAsset",method:"POST",params:{name:a.data.name,description:a.data.description,category:a.data.category,notes:a.data.notes,id:a.data.id,imgPath:d.data.path}}).then(function(a){200===a.status&&(e.data.showOverlay=!1,e.getAssets(),c.path("view_assets"))})}):b({url:"/internal/updateAsset",method:"POST",params:{name:a.data.name,description:a.data.description,category:a.data.category,notes:a.data.notes,id:a.data.id}}).then(function(a){200===a.status&&(e.data.showOverlay=!1,e.getAssets(),c.path("view_assets"))})},a.deleteAsset=function(){var d=confirm("You are about to permanantly delete this item from the inventory. Click 'OK' to continue.");d===!0&&b["delete"]("/internal/asset/"+a.data.id).then(function(a){200===a.status?(e.data.showOverlay=!1,c.path("/view_assets")):console.log("error deleting asset")})},a.goBack=function(){e.data.showOverlay=!1,c.path("view_assets")}}]),app.controller("AssetReservationController",["$scope","$http","$location","ReservationService","currentAsset",function(a,b,c,d,e){a.data=d.data,a.noPast=!0,a.goBack=function(){d.data.showOverlay=!1,c.path("view_assets")},a.reserveAsset=function(a){d.data.showOverlay=!1,e.setAsset(a),c.path("reserve_asset")},a.editReservation=function(a){d.data.showOverlay=!1,d.data.reservationToEdit=a,c.path("edit_reservation")},a.afterToday=function(a){var b=new Date(a.eventStartTime),c=new Date;return b>c},a.showPast=function(){a.noPast=!1,a.afterToday=function(a){return!0}},a.hidePast=function(){a.noPast=!0,a.afterToday=function(a){var b=new Date(a.eventStartTime),c=new Date;return b>c}}}]),app.factory("currentAsset",[function(){var a={},b=function(b){a.id=b.id,a.name=b.name,a.description=b.description,a.category=b.category,a.notes=b.notes,a.img_path=b.img_path},c=function(){a={}};return{currentAsset:a,setAsset:b,clearCurrentAsset:c}}]),app.factory("ReservationService",["$http",function(a){var b={},c=function(){a.get("internal/getReservations").then(function(a){b.reservations=a.data;for(var c=0;c<b.reservations.length;c++)for(var d=b.reservations[c],e=d.event_id,f=0;f<b.events.length;f++){var g=b.events[f];if(parseInt(e)===g.id){d.eventTitle=g.title,d.eventStartTime=g.start_date_time,d.eventEndTime=g.end_date_time;break}}b.reservations.sort(function(a,b){var c=new Date(a.eventStartTime),d=new Date(b.eventStartTime);return c-d})})},d=function(){var c,d;a.get("/api/siteList").then(function(e){c=e.data[0],d=c.id,a.get("/api/eventList/"+d).then(function(c){b.events=c.data.events,b.eventsAfterToday=[];for(var d=0;d<c.data.events.length;d++){var e=new Date(c.data.events[d].start_date_time),f=new Date;e>=f&&b.eventsAfterToday.push(c.data.events[d])}a.get("internal/getReservations").then(function(a){b.reservations=a.data;for(var c=0;c<b.reservations.length;c++)for(var d=b.reservations[c],e=d.event_id,f=0;f<b.events.length;f++){var g=b.events[f];if(parseInt(e)===g.id){d.eventTitle=g.title,d.eventStartTime=g.start_date_time,d.eventEndTime=g.end_date_time;break}}b.reservations.sort(function(a,b){var c=new Date(a.eventStartTime),d=new Date(b.eventStartTime);return c-d})})})})},e=function(){a.get("internal/getAssets").then(function(a){b.assets=a.data})};return{data:b,getEvents:d,getAssets:e,getReservations:c}}]),function(){var a=angular.element;angular.module("svgSprites",[]).directive("svgSprite",["$http","$log",function(a,b){return{restrict:"E",scope:{src:"@"},link:function(c,d){return c.src?void a.get(c.src).success(d.replaceWith.bind(d)).error(b.error):b.error("svg-sprite `src` attribute cannot be blank")}}}]).directive("svgImg",["$log",function(b){return{restrict:"E",scope:{"class":"=",use:"="},link:function(c,d){if(!c.use)return b.error("svg-img `use` attribute cannot be blank");var e=c["class"]?' class="'+c["class"]+'"':"",f=a("<svg"+e+'><use xlink:href="#svg-'+c.use+'"></use></svg>');d.replaceWith(f)}}}])}();